{"sql": "SELECT\n    customer_rk,\n    last_nm,\n    first_nm,\n    middle_nm\nFROM \n\tsrcdt.cd_customers\nWHERE \n\tvalid_to_dttm = '5999-01-01 00:00:00' \n    AND customer_rk IN (\n\t\tSELECT DISTINCT \n\t\t\tclosed.customer_rk \n\t\tFROM (\n\t\t\tSELECT\n\t\t\t\tcustomer_rk,\n\t\t\t\taccount_rk\n\t\t\tFROM srcdt.account_periods\n\t\t\tGROUP BY customer_rk, account_rk\n\t\t\tHAVING YEAR(MAX(expiration_dt)) = 2011\n\t\t) AS closed \n\t\tLEFT JOIN (\n\t\t\tSELECT DISTINCT\n\t\t\t\taccounts.customer_rk,\n\t\t\t\taccounts.account_rk \n\t\t\tFROM \n\t\t\t\t(SELECT\n\t\t\t\t\tcustomer_rk,\n\t\t\t\t\taccount_rk,\n          MIN(renewed_dt) AS renewed_dt,\n\t\t\t\t\tMAX(expiration_dt) AS expiration_dt\n\t\t\t\tFROM \n\t\t\t\t\tsrcdt.account_periods\n\t\t\t\tGROUP BY \n\t\t\t\t\tcustomer_rk, account_rk\n\t\t\t) AS acc\n            \t\tJOIN (\n\t\t\t\tSELECT\n\t\t\t\t\tcustomer_rk,\n\t\t\t\t\taccount_rk,\n\t\t\t\t\tMAX(expiration_dt) AS date_of_closing\n\t\t\t\tFROM \n\t\t\t\t\tsrcdt.account_periods\n\t\t\t\tGROUP BY \n\t\t\t\t\tcustomer_rk, account_rk\n\t\t\t\tHAVING YEAR(date_of_closing) = 2011\n\t\t\t) AS accounts\n\t\t\tON\n\t\t\t\taccounts.customer_rk = acc.customer_rk AND\n\t\t\t\taccounts.account_rk != acc.account_rk AND\n\t\t\t\taccounts.date_of_closing > acc.renewed_dt AND\n\t\t\t\taccounts.date_of_closing < acc.expiration_dt\n\t\t) AS not_closed\n\t\tON closed.customer_rk = not_closed.customer_rk AND\n\t\t\tclosed.account_rk = not_closed.account_rk\n\t\tWHERE\n\t\t\tnot_closed.account_rk IS NULL\n)\n", "valid_until": 2044796829.507124, "rows": 10664, "hash": 5907707297702183890, "data": "(15, '\u0410\u041a\u041e\u041f\u042f\u041d', '\u0412\u0410\u041b\u0415\u0420\u0418\u0419', '\u041b\u042c\u0412\u041e\u0412\u0418\u0427')"}