{"sql": "SELECT customer_rk, last_nm, first_nm, middle_nm\nFROM srcdt.cd_customers\nWHERE valid_to_dttm = '5999-01-01 00:00:00'\nAND customer_rk IN \n(\nSELECT DISTINCT quit.customer_rk \nFROM \n(\nSELECT customer_rk, account_rk\nFROM srcdt.account_periods\nGROUP BY customer_rk, account_rk\nHAVING YEAR(MAX(expiration_dt)) = 2011\n) AS quit\nLEFT JOIN \n(\nSELECT DISTINCT not_really_ended.customer_rk, not_really_ended.account_rk \nFROM \n(\nSELECT customer_rk, account_rk,\nMIN(renewed_dt) AS minrenewed, MAX(expiration_dt) AS maxexpired\nFROM srcdt.account_periods\nGROUP BY customer_rk, account_rk\n) AS accs1\nJOIN \n(\nSELECT customer_rk, account_rk, MAX(expiration_dt) AS maxexpired\nFROM srcdt.account_periods\nGROUP BY customer_rk, account_rk\nHAVING YEAR(maxexpired) = 2011\n) AS not_really_ended\nON not_really_ended.customer_rk = accs1.customer_rk AND\nnot_really_ended.account_rk != accs1.account_rk AND\naccs1.minrenewed < not_really_ended.maxexpired AND\nnot_really_ended.maxexpired < accs1.maxexpired\n) AS not_quitted\nON quit.customer_rk = not_quitted.customer_rk AND\nquit.account_rk = not_quitted.account_rk\nWHERE not_quitted.account_rk IS NULL\n)", "valid_until": 2044816792.538173, "rows": 10664, "hash": 5907707297702183890, "data": "(15, '\u0410\u041a\u041e\u041f\u042f\u041d', '\u0412\u0410\u041b\u0415\u0420\u0418\u0419', '\u041b\u042c\u0412\u041e\u0412\u0418\u0427')"}