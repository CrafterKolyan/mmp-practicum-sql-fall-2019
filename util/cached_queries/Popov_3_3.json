{"sql": "-- \u041f\u043e\u043d\u044f\u0442\u0438\u0435 \"\u0433\u043e\u0434\" \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \"\u043a\u0430\u0436\u0434\u044b\u0439 \u0433\u043e\u0434\" \u0432\u0437\u044f\u0442\u043e \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0441 \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u0451\u043c\n\nSELECT\n\tyears.date_year,\n    IFNULL(SUM(deposits.account_renewal_cnt = 1), 0) AS new_opened_amt,\n    IFNULL(SUM(deposits.account_renewal_cnt > 1), 0) AS prolonged_amt,\n    IFNULL(SUM(1.5 * prev_deposits.opening_amt < deposits.opening_amt), 0) AS profitable_amt\nFROM (\n\tSELECT\n\t\tDISTINCT YEAR(calendar_dt) AS date_year\n\tFROM\n\t\tsrcdt.calendar\n\t) as years\nLEFT JOIN \n\tsrcdt.account_periods AS deposits\nON\n\tyears.date_year = YEAR(deposits.renewed_dt)\nLEFT JOIN\n\tsrcdt.account_periods AS prev_deposits\nON\n\tdeposits.account_rk = prev_deposits.account_rk\n    AND deposits.account_renewal_cnt = prev_deposits.account_renewal_cnt + 1\nGROUP BY\n\tyears.date_year\n", "valid_until": 2044393082.555625, "rows": 13, "hash": 6135695584710108749, "data": "(2007, Decimal('0'), Decimal('0'), Decimal('0'))"}