{"sql": "SELECT\n\tcustomer_rk,\n    last_nm,\n    first_nm,\n    middle_nm\nFROM cd_customers\nWHERE valid_to_dttm = '5999-01-01 00:00:00' AND\n\tcustomer_rk IN (\n\t\tSELECT DISTINCT closed_2011.customer_rk FROM (\n\t\t\tSELECT\n\t\t\t\tcustomer_rk,\n\t\t\t\taccount_rk\n\t\t\tFROM account_periods\n\t\t\tGROUP BY customer_rk, account_rk\n\t\t\tHAVING YEAR(MAX(expiration_dt)) = 2011\n\t\t) as closed_2011 LEFT JOIN (\n\t\t\tSELECT DISTINCT\n\t\t\t\ta.customer_rk,\n\t\t\t\ta.account_rk\n\t\t\tFROM (\n\t\t\t\tSELECT\n\t\t\t\t\tcustomer_rk,\n\t\t\t\t\taccount_rk,\n\t\t\t\t\tMAX(expiration_dt) as closed_date\n\t\t\t\tFROM account_periods\n\t\t\t\tGROUP BY customer_rk, account_rk\n\t\t\t\tHAVING YEAR(closed_date) = 2011\n\t\t\t) AS a INNER JOIN account_periods as b\n\t\t\tON\n\t\t\t\ta.customer_rk = b.customer_rk AND\n\t\t\t\ta.account_rk <> b.account_rk AND\n\t\t\t\tb.renewed_dt < a.closed_date AND\n\t\t\t\tb.expiration_dt > a.closed_date\n\t\t) as not_total_closures\n\t\tON closed_2011.customer_rk = not_total_closures.customer_rk AND\n\t\t\tclosed_2011.account_rk = not_total_closures.account_rk\n\t\tWHERE\n\t\t\tnot_total_closures.account_rk IS NULL\n)\n", "valid_until": 2044767995.626018, "rows": 10669, "hash": 794618970915370226, "data": "(15, '\u0410\u041a\u041e\u041f\u042f\u041d', '\u0412\u0410\u041b\u0415\u0420\u0418\u0419', '\u041b\u042c\u0412\u041e\u0412\u0418\u0427')"}